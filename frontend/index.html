<!-- 
This software is provided for non-commercial use only.
Commercial use is strictly prohibited.
If you use, modify, or redistribute this software, you must provide proper attribution to the original author.
(c) 2026 Onur Tuna. All rights reserved.
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVR Dashboard</title>
    <!-- System fonts for offline use -->
    <style>
        :root {
            --font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
    </style>
    <link rel="stylesheet" href="style.css">
    <!-- HLS.js for video playback (loaded locally for offline use) -->
    <script src="hls.min.js"></script>
    <!-- Authentication Check -->
    <script>
        if (localStorage.getItem('nvr_auth_token') !== 'oasis_logged_in') {
            window.location.href = 'login.html';
        }
    </script>
</head>

<body>
    <div class="app-layout">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="oasis_nvr_logo.png" alt="Oasis NVR Logo"
                        style="width: 24px; height: 24px; object-fit: cover; border-radius: 50%;">
                    <span>Oasis NVR</span>
                </div>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-target="dashboard-view">
                    <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    Dashboard
                </a>
                <a href="#" class="nav-item" data-target="live-view">
                    <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                    Live View
                </a>
                <a href="#" class="nav-item" data-target="recordings-view">
                    <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Recordings
                </a>
                <a href="#" class="nav-item" data-target="configuration-view">
                    <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                    Configuration
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="status-indicator">
                    <span class="dot active"></span>
                    <span id="system-status-text">System Online</span>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <header class="top-header">
                <h1 id="page-title">Dashboard</h1>
                <div class="header-right" style="display: flex; align-items: center; gap: 20px;">
                    <div class="time-display" id="clock">00:00:00</div>
                    <button id="btn-logout" class="btn btn-secondary"
                        style="padding: 6px 12px; font-size: 0.85rem; width: auto; background: rgba(239, 83, 80, 0.15); color: #ef5350; border: 1px solid rgba(239, 83, 80, 0.3);">
                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2"
                            fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Logout
                    </button>
                </div>
            </header>

            <div class="content-container">
                <!-- Dashboard View -->
                <section id="dashboard-view" class="view active">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-icon blue">
                                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path
                                        d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z">
                                    </path>
                                    <circle cx="12" cy="13" r="4"></circle>
                                </svg>
                            </div>
                            <div class="metric-info">
                                <h3>Total Cameras</h3>
                                <p class="metric-value" id="dash-cams-count">-</p>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon purple">
                                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                                </svg>
                            </div>
                            <div class="metric-info">
                                <h3>Storage Pools</h3>
                                <p class="metric-value" id="dash-pools-count">-</p>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon green">
                                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
                                    <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
                                    <line x1="6" y1="6" x2="6.01" y2="6"></line>
                                    <line x1="6" y1="18" x2="6.01" y2="18"></line>
                                </svg>
                            </div>
                            <div class="metric-info">
                                <h3>Active Pool Usage</h3>
                                <p class="metric-value" id="dash-pool-usage">-</p>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon orange">
                                <svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2"
                                    fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </div>
                            <div class="metric-info">
                                <h3>Total Segments</h3>
                                <p class="metric-value" id="dash-segments">-</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Live View -->
                <section id="live-view" class="view">
                    <div class="camera-grid" id="live-cameras-container">
                        <!-- Dynamic camera cards will be injected here -->
                    </div>
                </section>

                <!-- Recordings View -->
                <section id="recordings-view" class="view">
                    <div class="recordings-layout">
                        <div class="recordings-sidebar">
                            <div class="control-group">
                                <label for="rec-camera-select">Select Camera</label>
                                <select id="rec-camera-select" class="form-input">
                                    <option value="" disabled selected>Loading cameras...</option>
                                </select>
                            </div>

                            <div class="segments-list-container">
                                <header class="segments-list-header">
                                    <h4>AVAILABLE RECORDINGS</h4>
                                    <button id="btn-fetch-segments" class="btn btn-icon" title="Refresh list">
                                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor"
                                            stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="23 4 23 10 17 10"></polyline>
                                            <polyline points="1 20 1 14 7 14"></polyline>
                                            <path
                                                d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15">
                                            </path>
                                        </svg>
                                    </button>
                                </header>
                                <div id="segments-list" class="segments-list">
                                    <div class="empty-state">Select a camera to view recordings</div>
                                </div>
                            </div>
                        </div>

                        <div class="recordings-player-container">
                            <div class="player-wrapper">
                                <video id="vod-player" controls playsinline></video>
                                <div class="player-overlay" id="vod-overlay">
                                    <span>Select a time range to play VOD</span>
                                </div>
                            </div>
                            <div class="player-controls">
                                <div class="fine-tune-controls">
                                    <div class="input-wrapper">
                                        <span>From:</span>
                                        <input type="datetime-local" id="rec-date-from" class="form-input compact"
                                            step="1">
                                    </div>
                                    <div class="input-wrapper">
                                        <span>To:</span>
                                        <input type="datetime-local" id="rec-date-to" class="form-input compact"
                                            step="1">
                                    </div>
                                </div>
                                <div class="button-group">
                                    <button id="btn-play-vod" class="btn btn-primary" disabled>
                                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor"
                                            stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                        </svg>
                                        Watch Selection
                                    </button>
                                    <button id="btn-download-vod" class="btn btn-secondary" disabled>
                                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor"
                                            stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="7 10 12 15 17 10"></polyline>
                                            <line x1="12" y1="15" x2="12" y2="3"></line>
                                        </svg>
                                        Export .TS
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Configuration View -->
                <section id="configuration-view" class="view">
                    <div class="config-layout" style="display:flex; gap: 24px; flex-wrap: wrap;">
                        <div class="config-panel"
                            style="flex:1; min-width:300px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: 24px;">
                            <h3 style="margin-bottom: 20px;">Add New Camera</h3>
                            <form id="add-camera-form">
                                <div class="control-group" style="padding:0; border:none; margin-bottom:16px;">
                                    <label for="new-cam-id">Camera ID</label>
                                    <input type="text" id="new-cam-id" class="form-input" placeholder="e.g. cam1"
                                        required>
                                </div>
                                <div class="control-group" style="padding:0; border:none; margin-bottom:16px;">
                                    <label for="new-cam-name">Display Name</label>
                                    <input type="text" id="new-cam-name" class="form-input"
                                        placeholder="e.g. Front Door" required>
                                </div>
                                <div class="control-group" style="padding:0; border:none; margin-bottom:16px;">
                                    <label for="new-cam-url">RTSP Stream URL</label>
                                    <input type="text" id="new-cam-url" class="form-input"
                                        placeholder="rtsp://user:pass@ip:port/stream" required>
                                </div>
                                <button type="submit" class="btn btn-primary mt-2">Add Camera</button>
                            </form>
                        </div>
                        <div class="config-panel"
                            style="flex:1; min-width:300px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: 24px;">
                            <h3 style="margin-bottom: 20px;">Configured Cameras</h3>
                            <div id="config-cameras-list" class="segments-list" style="padding:0;">
                                <div class="empty-state">Loading cameras...</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script>
        // Logout handler
        document.getElementById('btn-logout')?.addEventListener('click', () => {
            localStorage.removeItem('nvr_auth_token');
            window.location.href = 'login.html';
        });
    </script>
</body>

</html>